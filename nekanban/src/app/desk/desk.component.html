
<mat-sidenav-container class="example-container" >
  <mat-sidenav class = "my-sidenav" #sidenav mode="over" [(opened)]="opened" (opened)="events.push('open!')"
               (closed)="events.push('close!')">
    <h2 class="mat-h2">Мои доски</h2>
    <div class="sidenav-container">
      <mat-nav-list>
        <mat-list-item *ngFor="let desk of desks; index as i">
          <!--<a *ngIf="isCurrentDesk(i)" matLine (click) = "changeDesk(i)"><mat-icon>check_box</mat-icon>{{ desk.name }} {{desk.id}}<mat-divider></mat-divider></a>-->
          <a matLine (click) = "changeDesk(desk.id)">{{ desk.name }}<mat-divider></mat-divider></a>
        </mat-list-item>

        <!--<a mat-list-item *ngFor="let desk of desks"> {{ desk.name }}<mat-divider></mat-divider> </a>-->

      </mat-nav-list>
      <div class = "menu-bottom-button">
        <button class = "register_button" mat-raised-button color="primary" (click)="showDeskCreation()">Создать доску</button>
      </div>
    </div>


  </mat-sidenav>

  <mat-sidenav-content>
    <p>
      <mat-toolbar color="primary">
        <button mat-icon-button class="example-icon" aria-label="Example icon-button with menu icon" (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>
        <span>NeKanban</span>
        <span class="example-spacer"></span>
        <mat-icon>account_circle</mat-icon>
        <span class="user-name">{{ getCurrentUser().name}}</span>
        <button *ngIf="getCurrentDesk()!.deskUser.preference" mat-icon-button class="example-icon favorite-icon" aria-label="Example icon-button with heart icon" (click) = "removeFromFavourites(desk?.id)">
          <mat-icon>favorite</mat-icon>
        </button>
        <button *ngIf="!getCurrentDesk()!.deskUser.preference" mat-icon-button class="example-icon favorite-icon" aria-label="Example icon-button with heart icon" (click) = "addToFavourite(desk?.id)">
          <mat-icon>favorite_border</mat-icon>
        </button>

        <button mat-icon-button class="example-icon" aria-label="Example icon-button with share icon">
          <mat-icon>share</mat-icon>
        </button>
        <button mat-icon-button class="example-icon" aria-label="Example icon-button with share icon" (click)="logout()">
          <mat-icon>logout</mat-icon>
        </button>
      </mat-toolbar>
    </p>


      <mat-card>
        <mat-card-title-group>
          <mat-card-title>
            <p>{{desk?.name}}</p>
          </mat-card-title>
          <mat-card-subtitle>
            <p>Владелец: {{getDeskOwner()!.user.name}}</p>
          </mat-card-subtitle>
        </mat-card-title-group>
      </mat-card>

      <mat-card class = "desk-cards">
        <mat-card-title>
          <div class = "menu-bottom-button">
            <button class = "add-column-button" mat-raised-button color="primary" (click)="openColumnCreationDialog()"><mat-icon>add</mat-icon></button>
          </div>
        </mat-card-title>

        <!--<div cdkDropListGroup>-->
        <div cdkDropList
             [cdkDropListData]="columns"
             class="example-list"
             (cdkDropListDropped)="drop_column($event)"
        >
          <!--<div *ngFor="let column of columns">
            <div cdkDrag>
              {{column.name}}
            </div>
          </div>--
          class="column-cards"-->
          <div cdkDropListGroup class="column-cards">

            <div class="box-column-cards">
              <div *ngFor="let column of columns">
                <mat-card class = "column-card" cdkDrag>
                  <mat-card-title>
                    <p>{{column.name}}
                      <button mat-button [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
                      <mat-menu #menu="matMenu">
                        <button mat-menu-item><mat-icon>edit</mat-icon>Редактировать</button>
                        <button mat-menu-item (click)="removeColumn(column.id)"><mat-icon>delete</mat-icon>Удалить</button>
                      </mat-menu>
                    </p>
                  </mat-card-title>

                  <mat-card-content>
                    <mat-card-subtitle>
                      <p>Задачи:</p>
                      <button *ngIf="column.order == -1" mat-mini-fab color="primary" aria-label="Example icon button with a menu icon" (click)="openToDoCreationDialog()" >
                        <mat-icon>add</mat-icon>
                      </button>
                    </mat-card-subtitle>
                    <div
                      cdkDropList
                      [cdkDropListData]="getToDosForColumn(column.id)"
                      class="example-list"
                      (cdkDropListDropped)="drop($event)">
                      <div class="example-box" *ngFor="let toDo of getToDosForColumn(column.id)" cdkDrag (click)="showTaskCreation()">{{toDo.name}}<mat-icon (click)="showDeskCreation()">edit</mat-icon></div>
                    </div>
                  </mat-card-content>
                  <mat-expansion-panel (opened)="panelOpenState = true"
                                       (closed)="panelOpenState = false">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        Пользователи
                      </mat-panel-title>
                      <mat-panel-description>

                      </mat-panel-description>
                    </mat-expansion-panel-header>
                    <mat-nav-list class ="users-list">
                      <mat-list-item *ngFor="let user of desk!.deskUsers; index as i">
                        <a matLine>{{user.user.name}} </a><mat-divider></mat-divider>
                      </mat-list-item>

                      <!--<a mat-list-item *ngFor="let desk of desks"> {{ desk.name }}<mat-divider></mat-divider> </a>-->

                    </mat-nav-list>
                  </mat-expansion-panel>

                </mat-card>
              </div>

            </div>
          </div>
        </div>



        <mat-card class = "settings-card">
          <mat-card-title>
            <p>Настройки доски<mat-icon>settings</mat-icon></p>
          </mat-card-title>

          <mat-card-content>
            <mat-form-field appearance="fill">
              <mat-label>Название доски</mat-label>
              <input matInput placeholder="Новая доска" [formControl]="name" required>
              <mat-error *ngIf="name.invalid">Поле не должно быть пустым!</mat-error>
            </mat-form-field>
            <button class = "register_button" mat-raised-button color="primary" (click)="updateDesk(desk!.id)">Обновить название</button>

          </mat-card-content>
          <mat-card-subtitle *ngIf="hasAccessToInviteLink()" class="invite-link">
            <p><mat-icon>link</mat-icon>Ссылка для приглашения участников:</p>
            <p *ngIf="hasInviteLink()" class="p-link">{{ getInviteLink() }}</p>
            <button *ngIf="!hasInviteLink()" class = "register_button" mat-raised-button color="primary" (click)="generateLink()">Сгенерировать ссылку</button>
          </mat-card-subtitle>
          <mat-expansion-panel (opened)="panelOpenState = true"
                               (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Пользователи
              </mat-panel-title>
              <mat-panel-description>

              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-nav-list class ="users-list">
              <mat-list-item *ngFor="let user of desk!.deskUsers; index as i">
                <a matLine>{{user.user.name}} <mat-icon  *ngIf="hasAccessToInviteLink()" (click)="removeUser([user.user.id])">cancel</mat-icon></a><mat-divider></mat-divider>
              </mat-list-item>

              <!--<a mat-list-item *ngFor="let desk of desks"> {{ desk.name }}<mat-divider></mat-divider> </a>-->

            </mat-nav-list>
          </mat-expansion-panel>
          <button *ngIf="hasAccessToInviteLink()" class = "desk-remove-button" mat-raised-button color="warn" (click)="removeDesk(desk!.id)"><mat-icon>delete</mat-icon>Удалить доску</button>

        </mat-card>

      </mat-card>
    <!--<div cdkDropList class="example-list" (cdkDropListDropped)="drop_movie($event)">
      <div class="example-box" *ngFor="let movie of movies" cdkDrag>{{movie}}</div>
    </div>-->


  </mat-sidenav-content>
</mat-sidenav-container>
