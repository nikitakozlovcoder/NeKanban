<div class ="users-list">
  <mat-spinner class="spinner-centered" *ngIf="!(isUserRemoveLoaded | async)" diameter="20"></mat-spinner>
  <div *ngIf="!hideTableHeaders" class="single-user-title">
    <h2 class="h-18px">Имя пользователя</h2>
    <h2 class="h-18px">Роль</h2>
  </div>
  <div class="single-user-container" *ngFor="let deskUser of desk!.deskUsers; index as i">
    <!--<div class="single-user">
      <p class="desk-user-name">{{deskUser.user.name}} {{deskUser.user.surname}}</p>
      <div class="select"
           *ngIf="rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.ChangeUserRole) &&
           !deskUser.isOwner">
        <select class="user-role-select" (change)="changeUserRole(deskUser.role.id, deskUser.id)" [(ngModel)]="deskUser.role.id">
          <option *ngFor="let role of roles" [ngValue]="role.id">
            {{role.name}}
          </option>
        </select>
        <svg *ngIf="rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.ChangeUserRole) && !desk!.deskUsers[i].isOwner">
          <use xlink:href="#select-arrow-down"></use>
        </svg>
      </div>
      <svg class="sprites">
        <symbol id="select-arrow-down" viewbox="0 0 10 6">
          <polyline points="1 1 5 5 9 1"></polyline>
        </symbol>
      </svg>

      <div class="role-name" *ngIf="deskUser.isOwner">
        Владелец
      </div>
      <div class="role-name"
           *ngIf="!rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.ChangeUserRole) &&
           !deskUser.isOwner">
        {{deskUser.role.name}}
      </div>
      <mat-icon class="cancel-icon"
                *ngIf="(isUserRemoveLoaded | async) &&
                rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.RemoveUsers) &&
                !deskUser.isOwner" (click)="removeUser([deskUser.user.id])" matTooltip="Удалить пользователя">cancel
      </mat-icon>
    </div>-->
    <app-single-user [deskUser]="deskUser"
                     [currentDeskUser]="deskUserService.getCurrentDeskUser(desk)!"
                     [deskId]="desk!.id"
                     [roles]="roles"
                     [isUserDeleted]="false"
                     (deskChange)="handleDeskChange($event)"
                     (deskUsersChange)="handleDeskUsersChange($event)"></app-single-user>
    <mat-divider *ngIf="!hideTableHeaders"></mat-divider>
  </div>

</div>
<div class ="users-list" *ngIf="rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.ManageDeletedUsers)">
  <h2 class="h-main-title deleted-users-title">Удаленные пользователи</h2>
  <div *ngIf="!hideTableHeaders" class="single-user-title">
    <h2 class="h-18px">Имя пользователя</h2>
    <h2 class="h-18px">Причина удаления</h2>
  </div>
  <div class="single-user-container" *ngFor="let deskUser of deletedUsers; index as i">
    <!--<div class="single-deleted-user">
      <p class="desk-user-name">{{deskUser.user.name}} {{deskUser.user.surname}}</p>
      <ng-container *ngIf="deskUser.deletionReason === deletionReason.Exited; else kickedUser">
        <div class="deletion-reason exited-user-deletion-reason">
          Покинул доску
        </div>
        <mat-icon class="cancel-icon exited-user-delete-icon"
                  *ngIf="(isUserRemoveLoaded | async)  &&
                rolesService.userHasPermission(this.roles, deskUserService.getCurrentDeskUser(desk)!, rolesService.permissionsTypes.RemoveUsers) &&
                !deskUser.isOwner" (click)="removeUser([deskUser.user.id])" matTooltip="Удалить пользователя">cancel
        </mat-icon>
      </ng-container>
      <ng-template #kickedUser>
        <div class="deletion-reason">
          Исключен
        </div>
        <button class="user-restore-button"
                mat-raised-button color="primary" (click)="revertDeleted(deskUser.id)">
          <mat-icon>undo</mat-icon>
          Восстановить
        </button>
      </ng-template>


    </div>-->
    <app-single-user [deskUser]="deskUser"
                     [currentDeskUser]="deskUserService.getCurrentDeskUser(desk)!"
                     [deskId]="desk!.id"
                     [roles]="roles"
                     [isUserDeleted]="true"
                     (deskChange)="handleDeskChange($event)"
                     (deskUsersChange)="handleDeskUsersChange($event)"></app-single-user>
    <mat-divider *ngIf="!hideTableHeaders"></mat-divider>
  </div>
</div>
